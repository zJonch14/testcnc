name: Tmate Session SSH Accessssss

# Se dispara NICAMENTE de forma manual.
on:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  tmate_manual:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout del c贸digo (Opcional)
        uses: actions/checkout@v4

      - name: 1. Instalar Tmate
        run: |
          sudo apt update
          # -y para confirmar la instalaci贸n sin preguntar
          sudo apt install tmate -y

      - name: 2. Iniciar Tmate, Imprimir Conexi贸n y Mantener Activo
        run: |
          # 1. Inicia tmate en modo no interactivo (-d), crea un socket temporal (-f),
          # y adj煤ntalo a una sesi贸n sin nombre.
          tmate -S /tmp/tmate.sock new-session -d

          # 2. Obtiene e imprime la l铆nea de conexi贸n SSH/Web en los logs.
          echo "======================================================================"
          echo " Con茅ctate usando esta l铆nea SSH (c贸piala y p茅gala en tu terminal):"
          tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}'
          echo " Tambi茅n puedes usar la URL del Web-Shell:"
          tmate -S /tmp/tmate.sock display -p '#{tmate_web}'
          echo "======================================================================"
          echo "El runner de GitHub Actions permanecer谩 activo por 6 horas o hasta que"
          echo "canceles manualmente este Job."
          
          # 3. Mantiene el job activo indefinidamente con un bucle "sleep". 
          # Una vez conectado, puedes matar el proceso "sleep" manualmente si quieres finalizar el job.
          sleep 6h

